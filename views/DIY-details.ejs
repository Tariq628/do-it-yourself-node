<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project details</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <div class="container">
        <div class="navbar">
            <div class="logo">
                <a href="/"><img src="/images/Schermafbeelding 2023-12-16 201941.png" width="125px">
                </a> </div>
            <nav>
                <ul id="MenuItems">
                    <li><a href="/">Home</a></li>
                    <li><a href="/categorieen">Alle categorieën</a></li>
                    <li><a href="/decoratie">decoratie</a></li>
                    <li><a href="/meubels">meubels</a></li>
                    <li><a href="/dieren">dieren</a></li>
                    <li><a href="/account">Account</a></li>
                </ul>
            </nav>
            <a href="/favorieten"><img src="/images/pngwing.com (91).png" width="30px" height="30px"></a>
            <img src="/images/menu.png" class="menu-icon" onclick="menutoggle()">

        </div>
    </div>
   
    <div class="small-container single-product">
        <div class="row">
            <div class="col-2">
                <img src="/images/kerststal2.jpg" width="100%" id="ProductImg">
                <div class="small-img-row">
                    <div class="small-img-col">
                        <img src="/images/kerststal2.jpg" width="100%" class="small-img">
                    </div>
                    <div class="small-img-col">
                        <img src="/images/kerststal.jpg" width="100%" class="small-img">
                    </div>
                    <div class="small-img-col">
                        <img src="/images/kerststal3.jpg" width="100%" class="small-img">
                    </div>
                    <div class="small-img-col">
                        <img src="/images/kerststal4.jpg" width="100%" class="small-img">
                    </div>
                </div>
            </div>
            <div class="col-2">
                <p id="category"></p>
                <h1 id="title"></h1>
                <h4 id="details"></h4>
                <a href="" class="btn" id="addToLikes"> Add To Likes </a>
                <h3>Inleiding <i class="fa fa-indent"></i></h3>
                <br>
                <p id="description"></p>
            </div>
        </div>
    </div>

    <div class="small-container" style="margin-right: 200px; margin-top: 30px;"></div>
    <div class="row">
        <div class="col-2" style="flex: 0 0 48%; max-width: 48%;">
            <section style="margin-bottom: 30px;">
                <h2>1. Onderdelen op maat zagen</h2>
                <p>
                    Bepaal voor het schuine dak het middelpunt van de bovenkant van de achterwand en markeer dat met
                    een potlood. Meet aan de beide zijkanten telkens 10 cm af en markeer ook dit. Verbind die twee
                    punten met het middelpunt aan de bovenkant.
                </p>
            </section>
            <section style="margin-bottom: 30px;">
                <h2>2. Achterwand monteren</h2>
                <p>
                    Lijm de achterwand met houtlijm aansluitend op de bodemplaat vast, de afstanden tot de zijkanten
                    bedragen daarbij steeds 5 cm. Voor meer stabiliteit kun je de achterwand aan de onderkant
                    vastspijkeren of vastschroeven, bijvoorbeeld met een accuschroefboormachine.
                </p>
            </section>
            <section style="margin-bottom: 30px;">
                <h2>3. Voorkant en zijdelingse verbindingen aanbrengen</h2>
                <p>
                    Monteer voor de voorkant zes stukken lat van verschillende grootte volgens de schets en lijm ze
                    aan elkaar vast. Verbind de voorkant met de vier 13,5 cm lange latten met de achterkant en lijm
                    het geheel vast op de bodemplaat.
                </p>
            </section>
            <section style="margin-bottom: 30px;">
                <h2>4. Dak aanbrengen</h2>
                <p>
                    Lijm voor het dak de overige 14 latten overlappend op de basisconstructie.
                </p>
            </section>
            <section>
                <h2>5. Kerststal inrichten</h2>
                <p>
                    Nadat de lijm volledig droog is, kun je je zelfgemaakte kerststal naar je eigen smaak inrichten.
                    Je kunt de zij- en achterkanten of het dak bijvoorbeeld met boomschors bekleden. Gips of mortel
                    zorgen voor een realistisch beeld. Veel meer andere ideeën vind je in het hoofdstuk “Planning &
                    achtergrondinformatie”.
                </p>
            </section>
        </div>
    </div>
    </div>

    <div class="small-container">
        <div class="row row-2">
            <h2>Gerelateerde Projecten</h2>
            <p><u>Bekijk Meer</u></p>
        </div>
    </div>

    <div class="small-container">
        <div class="row">
            <div class="col-4">
                <img src="/images/kerstboomvariant.jpg">
                <h4>Kerstboomvariant</h4>
                <div class="rating">
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star-o"></i>
                </div>
                <p><u>Bekijken</u></p>
            </div>
            <div class="col-4">
                <img src="/images/kerstkrans.jpg">
                <h4>Kerstkrans</h4>
                <div class="rating">
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star-o"></i>
                </div>
                <p><u>Bekijken</u></p>
            </div>
            <div class="col-4">
                <img src="/images/kerststal3.jpg">
                <h4>Kerststal</h4>
                <div class="rating">
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star-half-o"></i>
                </div>
                <p><u>Bekijken</u></p>
            </div>
            <div class="col-4">
                <img src="/images/kerststal4.jpg">
                <h4>Kerststal</h4>
                <div class="rating">
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star-o"></i>
                </div>
                <p><u>Bekijken</u></p>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="footer-col-1">
                    <h3>Download our App</h3>
                    <p>download app for android ios playstore</p>
                    <div class="app-logo">
                        <img src="/images/play-store.png">
                        <img src="/images/app-store.png">
                    </div>
                </div>
                <div class="footer-col-2">
                    <img src="/images/logo.png">
                    <p>Our Purpose Is To Sustainably Make the Pleasure and Benefits of upcycling Accessible to the Many
                    </p>
                </div>
                <div class="footer-col-3">
                    <h3>Useful Links</h3>
                    <ul>
                        <li>Coupons</li>
                        <li>Blog Post</li>
                        <li>Return Policy</li>
                        <li>Join Affiliate</li>
                    </ul>
                </div>
                <div class="footer-col-4">
                    <h3>Follow us</h3>
                    <ul>
                        <li>Facebook</li>
                        <li>twitter</li>
                        <li>instagram</li>
                        <li>Youtube</li>
                    </ul>
                </div>
            </div>
            <hr>
            <p class="copyright"> Copyright 2023 - DIY Fraai industries</p>
        </div>
    </div>

    <script>
        var MenuItems = document.getElementById("MenuItems");
        MenuItems.style.maxHeight = "0px";

        function menutoggle() {
            if (MenuItems.style.maxHeight == "0px") {
                MenuItems.style.maxHeight = "200px";
            } else {
                MenuItems.style.maxHeight = "0px";
            }
        }
    </script>

    <script>
        var ProductImg = document.getElementById("ProductImg");
        var SmallImg = document.getElementsByClassName("small-img");
        SmallImg[0].onclick = function () {
            ProductImg.src = SmallImg[0].src;
        }
        SmallImg[1].onclick = function () {
            ProductImg.src = SmallImg[1].src;
        }
        SmallImg[2].onclick = function () {
            ProductImg.src = SmallImg[2].src;
        }
        SmallImg[3].onclick = function () {
            ProductImg.src = SmallImg[3].src;
        }


	// Function to handle the like button click
    async function handleLikeButtonClick() {
        // const projectId = "6585bf8db8a030557d9389f3"; // Replace with your project ID
        const projectId = '<%= projectID %>';
        const token = localStorage.getItem('token');

        try {
            // Fetch user data
            const userResponse = await fetch('http://localhost:3000/api/users/me', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                },
            });

            if (!userResponse.ok) {
                throw new Error('Failed to fetch user data');
            }

            const userData = await userResponse.json();

            // Check if projectId is in favoriteProjects
            const isFavorite = userData.favoriteProjects.includes(projectId);

            // Perform the appropriate action (add or remove)
            if (isFavorite) {
                // Remove from favorites
                const removeResponse = await fetch(`http://localhost:3000/api/projects/remove-from-favorites/${projectId}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                    },
                });

                if (!removeResponse.ok) {
                    throw new Error('Failed to remove from favorites');
                }
            } else {
                // Add to favorites
                const addResponse = await fetch(`http://localhost:3000/api/projects/add-to-favorites/${projectId}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                    },
                });

                if (!addResponse.ok) {
                    throw new Error('Failed to add to favorites');
                }
            }

            // Update the button text and href after successfully adding to or removing from favorites
            const addToLikesButton = document.getElementById('addToLikes');
            addToLikesButton.innerText = isFavorite ? 'Add to favorites' : 'Remove from favorites';
            addToLikesButton.href = isFavorite
                ? `http://localhost:3000/api/projects/add-to-favorites/${projectId}`
                : `http://localhost:3000/api/projects/remove-from-favorites/${projectId}`;
        } catch (error) {
            console.error(error);
        }
    }

    // Attach the handleLikeButtonClick function to the click event of the addToLikes button
    document.getElementById('addToLikes').addEventListener('click', function (event) {
        event.preventDefault(); // Prevent the default behavior of the anchor tag (opening the href)
        handleLikeButtonClick();
    });

        // Function to make an authenticated API call and populate project details
        async function fetchProjectDetails() {
            const projectId = '<%= projectID %>';
            // console.log({itemId})
            // const projectId = "6585bf8db8a030557d9389f3"; // Replace with your project ID
            const token = localStorage.getItem('token');

            try {
                const response = await fetch(`http://localhost:3000/api/projects/${projectId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                    },
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch project details');
                }

                const projectData = await response.json();

                // Populate HTML elements with project details
                document.getElementById('category').innerText = projectData.category;
                document.getElementById('title').innerText = projectData.title;
                document.getElementById('details').innerText = `Duur: ${projectData.duration} 
                Kosten: ${projectData.cost} 
                Moeilijkheid: ${projectData.difficulty}`;
                                // document.getElementById('addToLikes').href = "http://localhost:3000/api/projects/add-to-favorites/${projectId}"; // Add your liking functionality URL
                document.getElementById('description').innerText = projectData.short_description;

                // Fetch user data
                const userResponse = await fetch('http://localhost:3000/api/users/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                    },
                });

                if (!userResponse.ok) {
                    throw new Error('Failed to fetch user data');
                }

                const userData = await userResponse.json();

                // Check if projectId is in favoriteProjects
                const isFavorite = userData.favoriteProjects.includes(projectId);

                // Dynamically change the text and href of the "Add to Like" button
                const addToLikesButton = document.getElementById('addToLikes');
                addToLikesButton.innerText = isFavorite ? 'Remove from favorite' : 'Add to favourite';
                addToLikesButton.href = isFavorite
                    ? `http://localhost:3000/api/projects/remove-from-favorites/${projectId}`
                    : `http://localhost:3000/api/projects/add-to-favorites/${projectId}`;

            } catch (error) {
                console.error(error);
            }
        }

        // Call the function when the page loads
        fetchProjectDetails();
    </script>
</body>

</html>
